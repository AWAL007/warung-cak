<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pemesanan Makanan - Warung Nusantara</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .menu-item:hover {
        transform: translateY(-2px);
        transition: all 0.3s ease;
      }
      .loading {
        display: none;
      }
      .success {
        display: none;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-orange-50 to-red-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">
          üçΩÔ∏è Warung Nusantara
        </h1>
        <p class="text-gray-600">Pesan makanan favorit Anda dengan mudah</p>
      </div>

      <!-- Form Pemesanan -->
      <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6">
          üìù Form Pemesanan
        </h2>

        <form id="orderForm" class="space-y-6">
          <!-- Data Pelanggan -->
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Nama Lengkap *</label
              >
              <input
                type="text"
                id="customerName"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >No. WhatsApp *</label
              >
              <input
                type="tel"
                id="phoneNumber"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                placeholder="08xxxxxxxxxx"
              />
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Alamat Pengiriman *</label
            >
            <textarea
              id="address"
              required
              rows="3"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              placeholder="Masukkan alamat lengkap untuk pengiriman"
            ></textarea>
          </div>

          <!-- Menu Makanan -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
              üçõ Pilih Menu
            </h3>
            <div
              class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"
              id="menuContainer"
            >
              <!-- Menu items akan diisi oleh JavaScript -->
            </div>
          </div>

          <!-- Total dan Catatan -->
          <div class="bg-gray-50 rounded-lg p-6">
            <div class="flex justify-between items-center mb-4">
              <span class="text-lg font-semibold text-gray-800"
                >Total Pesanan:</span
              >
              <span id="totalPrice" class="text-2xl font-bold text-orange-600"
                >Rp 0</span
              >
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Catatan Tambahan</label
              >
              <textarea
                id="notes"
                rows="2"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                placeholder="Contoh: Pedas sedang, tanpa bawang, dll."
              ></textarea>
            </div>
          </div>

          <!-- Submit Button -->
          <button
            type="submit"
            class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white font-semibold py-4 px-6 rounded-lg hover:from-orange-600 hover:to-red-600 transform hover:scale-105 transition-all duration-300 shadow-lg"
          >
            <span class="normal-text">üöÄ Kirim Pesanan</span>
            <span class="loading">‚è≥ Mengirim...</span>
          </button>
        </form>

        <!-- Success Message -->
        <div
          class="success bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mt-6"
        >
          ‚úÖ Pesanan berhasil dikirim! Kami akan segera menghubungi Anda.
        </div>
      </div>

      <!-- Instruksi Google Sheets -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-blue-800 mb-3">
          üìä Cara Menghubungkan ke Google Sheets:
        </h3>
        <ol class="list-decimal list-inside space-y-2 text-blue-700 text-sm">
          <li>
            Buat Google Sheet baru dengan kolom: Tanggal, Nama, No HP, Alamat,
            Pesanan, Total, Catatan
          </li>
          <li>Buka Extensions ‚Üí Apps Script di Google Sheets</li>
          <li>Ganti kode dengan Web App yang menerima POST request</li>
          <li>Deploy sebagai Web App dan copy URL-nya</li>
          <li>Ganti variabel GOOGLE_SCRIPT_URL di kode JavaScript di bawah</li>
        </ol>
      </div>
    </div>

    <script>
      // GANTI URL INI DENGAN URL GOOGLE APPS SCRIPT ANDA
      const GOOGLE_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbx2V0INlP6h3oQHlJ8uK0B4YiWjnJQWnlPNN01VLSAjPzyB6WmomkHIwBAI45Fg2h28/exec";
      // Data Menu
      const menuItems = [
        { id: 1, name: "Nasi Gudeg", price: 15000, emoji: "üçõ" },
        { id: 2, name: "Ayam Bakar", price: 20000, emoji: "üçó" },
        { id: 3, name: "Gado-Gado", price: 12000, emoji: "ü•ó" },
        { id: 4, name: "Soto Ayam", price: 13000, emoji: "üç≤" },
        { id: 5, name: "Rendang", price: 25000, emoji: "üçñ" },
        { id: 6, name: "Es Teh Manis", price: 5000, emoji: "üßä" },
        { id: 7, name: "Es Jeruk", price: 7000, emoji: "üçä" },
        { id: 8, name: "Kerupuk", price: 3000, emoji: "üçò" },
      ];

      let selectedItems = {};
      let totalPrice = 0;

      // Render Menu
      function renderMenu() {
        const container = document.getElementById("menuContainer");
        container.innerHTML = menuItems
          .map(
            (item) => `
                <div class="menu-item bg-white border border-gray-200 rounded-lg p-4 shadow-sm cursor-pointer">
                    <div class="text-center mb-3">
                        <div class="text-3xl mb-2">${item.emoji}</div>
                        <h4 class="font-semibold text-gray-800">${
                          item.name
                        }</h4>
                        <p class="text-orange-600 font-bold">Rp ${item.price.toLocaleString()}</p>
                    </div>
                    <div class="flex items-center justify-center space-x-3">
                        <button type="button" onclick="updateQuantity(${
                          item.id
                        }, -1)" 
                                class="w-8 h-8 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors">-</button>
                        <span id="qty-${
                          item.id
                        }" class="font-semibold text-lg w-8 text-center">0</span>
                        <button type="button" onclick="updateQuantity(${
                          item.id
                        }, 1)" 
                                class="w-8 h-8 bg-green-500 text-white rounded-full hover:bg-green-600 transition-colors">+</button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Update Quantity
      function updateQuantity(itemId, change) {
        const item = menuItems.find((m) => m.id === itemId);
        if (!selectedItems[itemId]) selectedItems[itemId] = 0;

        selectedItems[itemId] += change;
        if (selectedItems[itemId] < 0) selectedItems[itemId] = 0;

        document.getElementById(`qty-${itemId}`).textContent =
          selectedItems[itemId];
        updateTotal();
      }

      // Update Total Price
      function updateTotal() {
        totalPrice = 0;
        for (const [itemId, quantity] of Object.entries(selectedItems)) {
          const item = menuItems.find((m) => m.id == itemId);
          totalPrice += item.price * quantity;
        }
        document.getElementById(
          "totalPrice"
        ).textContent = `Rp ${totalPrice.toLocaleString()}`;
      }

      // Submit Form
      document
        .getElementById("orderForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          // Validasi pesanan
          const hasOrder = Object.values(selectedItems).some((qty) => qty > 0);
          if (!hasOrder) {
            alert("Silakan pilih minimal satu menu!");
            return;
          }

          // Show loading
          document.querySelector(".normal-text").style.display = "none";
          document.querySelector(".loading").style.display = "inline";

          // Prepare order data
          const orderDetails = menuItems
            .filter((item) => selectedItems[item.id] > 0)
            .map(
              (item) =>
                `${item.name} x${selectedItems[item.id]} = Rp ${(
                  item.price * selectedItems[item.id]
                ).toLocaleString()}`
            )
            .join("\n");

          const formData = {
            timestamp: new Date().toLocaleString("id-ID"),
            customerName: document.getElementById("customerName").value,
            phoneNumber: document.getElementById("phoneNumber").value,
            address: document.getElementById("address").value,
            orderDetails: orderDetails,
            totalPrice: `Rp ${totalPrice.toLocaleString()}`,
            notes: document.getElementById("notes").value || "-",
          };

          try {
            // Kirim ke Google Sheets (akan error jika URL belum diset)
            const response = await fetch(GOOGLE_SCRIPT_URL, {
              method: "POST",
              mode: "no-cors",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            });

            // Show success message
            document.querySelector(".success").style.display = "block";
            document.getElementById("orderForm").reset();
            selectedItems = {};
            totalPrice = 0;
            renderMenu();
            updateTotal();

            // Scroll to success message
            document
              .querySelector(".success")
              .scrollIntoView({ behavior: "smooth" });
          } catch (error) {
            alert("Terjadi kesalahan. Pastikan URL Google Script sudah benar!");
            console.error("Error:", error);
          }

          // Hide loading
          document.querySelector(".normal-text").style.display = "inline";
          document.querySelector(".loading").style.display = "none";
        });

      // Initialize
      renderMenu();
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'97f3c63c1564fd75',t:'MTc1Nzg5MzY5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
